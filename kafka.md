# Kafka
카프카는 데이터 단위를 보내는 측(publisher, producer)에서 토픽이라는 각각의 메시지 저장소에 데이터를 저장하면, 가져가는 측(subscriber, consumer)이 
원하는 토픽에서 데이터를 가져가는 것이 기본 동작 방식이다. 
> 중앙에 메시징 시스템 서버를 두고 메시지를 publish 하고 subscribe 하는 형태의 통신은 pub/sub 모델이라고 한다. 

## 카프카의 특징
### 프로듀서와 컨슈머의 분리
카프카는 메시지를 보내는 역할과 받는 역할이 완전히 분리된 pub/sub 방식을 적용했다. Publisher 는 수신자가 정해져있지 않은 상태의 메시지를 발행하고, 
구독을 신청한 Subscriber 만 정해진 메시지를 받을 수 있다. 
이 때, Publisher 와 마찬가지로 Subscriber 도 발신자 정보 없이 원하는 메시지만 수신할 수 있다. 
이렇게 각자의 역할이 완벽하게 분리되면서, 어느 한쪽 시스템에 문제가 발생하더라도 연쇄작용이 발생할 확률을 낮출 수 있게 되었다. 

### 멀티 프로듀서, 멀티 컨슈머
카프카는 하나의 토픽에 여러 프로듀서나 컨슈머들이 접근 가능한 구조로 되어있다. 프로듀서와 컨슈머는 각각 하나 이상의 토픽으로 메시지를 보내고, 
가져오는 것이 가능하다. 

### 디스크에 메시지 저장
기존의 메시징 시스템과 카프카의 가장 다른 특징 중 하나는 바로 디스크에 메시지를 저장하고 유지하는 것이다. 일반적인 메시징 시스템은 컨슈머가 메시지를 
읽어가면 큐에서 바로 메시지를 삭제한다. 반면에 카프카는 컨슈머가 메시지를 읽어가더라도 정해져있는 보괁누기 동안 디스크에 메시지를 저장해준다. 
덕분에 일시적으로 트래픽이 폭주하는 등의 문제로 컨슈머의 처리가 늦어지더라도 메시지는 디스크에 보관되어있기 때문에 컨슈머는 손실없이 메시지를 
가져갈 수 있다. 

### 확장성
하나의 카프카 클러스터는 3대의 브로커로 시작해서 수십대의 브로커로 확장이 가능하다. 확장 작업은 카프카 서비스의 중단없이 온라인 상태에서 작업이 
가능하다. 

### 높은 성능
카프카는 분산 처리, 배치 처리 등 다양한 기법을 통해 고성능을 유지한다. 
- 카프카는 단순한 메시지 헤더를 지닌 TCP 기반의 프로토콜을 사용해서 프로토콜에 의한 오버헤드를 감소시켰다. 

#### 배치처리
- Producer 가 broker 에게 다수의 메시지를 전송할 때 각 메시지를 개별적으로 전송해야하는 기존 메시징 시스템(ActiveMQ, RabbitMQ)과는 달리, 
다수의 메시지를 batch 형태로 broker 에세 한 번에 전달할 수 있어서 TCP/IP 라운드 트립 횟수를 줄일 수 있다. 
- Consumer 는 broker 로부터 직접 메시지를 가지고 가는 pull 방식으로 동작하기 때문에 자신의 처리 능력만큼의 메시지만 가져올 수 있기 때문에 최적의 
성능을 낼 수 있으며, 메시지를 쌓아두었다가 주기적으로 처리하는 batch consumer 를 구현할 수 있다. 

  
